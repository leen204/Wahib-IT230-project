<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hospital Profile | Wahib</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand:#b91c1c; --brand-dark:#951515; --bg:#f7f7f8; --card:#fff; --stroke:#eee;
      --muted:#666; --shadow:0 10px 30px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:#333}

    /* ===== Header ===== */
    header{
      background:var(--brand);color:#fff;
      display:flex;align-items:center;justify-content:space-between;
      padding:12px 40px;z-index:10;
    }
    .logo{display:flex;align-items:center;gap:10px;cursor:pointer;transition:transform .15s ease, filter .15s ease}
    .logo:hover{transform:scale(1.03);filter:brightness(.95)}
    .logo img{height:45px;width:45px;border-radius:8px;object-fit:cover}
    .brand{font-weight:700;letter-spacing:.3px;font-size:17px;white-space:nowrap}
    nav a{color:#fff;text-decoration:none;font-weight:600;margin-left:22px}
    nav a:hover{opacity:.9}

    /* ===== Layout ===== */
    .container{max-width:900px;margin:28px auto;padding:0 20px}
    h2{color:var(--brand);margin:0 0 14px}
    .card{background:var(--card);border:1.5px solid var(--stroke);border-radius:16px;box-shadow:var(--shadow)}
    .row{display:grid;grid-template-columns:190px 1fr;gap:18px;padding:20px}
    @media(max-width:800px){.row{grid-template-columns:1fr;}}
    .ph{background:#e9e9ea;border:1px solid #ddd;border-radius:12px;width:100%;height:160px;display:flex;align-items:center;justify-content:center;color:#999;font-weight:700}
    .line{background:#f3f3f4;border:1px solid #e6e6e7;border-radius:12px;padding:14px 16px;margin-top:12px}
    .title{font-size:13px;color:#777;margin-bottom:6px}
    .val{font-weight:700}
    .muted{color:var(--muted)}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn{background:var(--brand);color:#fff;border:0;border-radius:10px;padding:10px 14px;font-weight:800;cursor:pointer;text-decoration:none}
    .btn:hover{background:var(--brand-dark)}
    .btn.outline{background:#fff;color:var(--brand);border:1px solid var(--brand)}
    .icon-btn{background:#fafafa;border:1px solid #eee;border-radius:10px;padding:8px 10px;cursor:pointer;font-weight:700}
    .icon-btn:hover{background:#f0f0f0}
    .footer{margin-top:24px;padding:22px 10px;background:var(--brand);color:#fff;text-align:center;border-radius:0}

    /* ===== Edit dialog ===== */
    dialog{border:0;border-radius:16px;max-width:560px;width:92%;padding:0;box-shadow:0 20px 60px rgba(0,0,0,.25)}
    .dlg-head{padding:16px 20px;background:#fafafa;border-bottom:1px solid #eee;font-weight:800}
    .dlg-body{padding:18px 20px}
    .dlg-actions{display:flex;gap:8px;justify-content:flex-end;padding:14px 20px;border-top:1px solid #eee}
    label{display:block;font-weight:700;margin:10px 0 6px}
    input,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #ddd;font:inherit}
    textarea{min-height:90px;resize:vertical}
  </style>
</head>
<body>
  <!-- ===== Header ===== -->
  <header>
    <div class="logo" onclick="location.href='hospital_dashboard.html'">
      <img id="headerLogo" src="https://dummyimage.com/80x80/b91c1c/ffffff&text=W" alt="Hospital Logo">
      <span class="brand" id="brandName">Wahib</span>
    </div>
    <nav>
      <a href="hospital_dashboard.html">Dashboard</a>
      <a href="add_request.html">Add Request</a>
      <a href="hospital_profile.html">Profile</a>
    </nav>
  </header>

  <!-- ===== Main Content ===== -->
  <div class="container">
    <h2>Hospital Profile</h2>

    <div class="card">
      <div class="row">
        <div>
          <img id="logoImg" class="ph" alt="Hospital Logo" />
        </div>

        <div>
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="title">Hospital Name</div>
              <div class="val" id="vName">—</div>
            </div>
            <button class="icon-btn" onclick="openEdit()">✏️ Edit</button>
          </div>

          <div class="line">
            <div class="title">City / Region</div>
            <div class="val" id="vCity">—</div>
          </div>

          <div class="line">
            <div class="title">Location</div>
            <div class="val" id="vLocation">—</div>
          </div>
        </div>
      </div>

      <div class="line" style="margin:0 20px 16px">
        <div class="title">Branches</div>
        <div id="vBranches" class="val">—</div>
        <div class="muted" style="margin-top:4px">If multiple, listed one per line.</div>
      </div>

      <div class="line" style="margin:0 20px 20px">
        <div class="title">MOH License</div>
        <div class="actions" style="margin-top:6px">
          <input id="licenseFile" type="file" accept=".pdf,.jpg,.jpeg,.png" style="display:none">
          <button class="btn" onclick="triggerUpload()">Upload / Replace</button>
          <button class="btn outline" id="viewBtn" disabled onclick="viewLicense()">View License</button>
          <button class="icon-btn" id="removeBtn" style="display:none" onclick="removeLicense()">Remove</button>
        </div>
        <div class="muted" id="licenseMeta" style="margin-top:6px">No file uploaded yet.</div>
      </div>
    </div>
  </div>

  <div class="footer">© 2025 Wahib Blood Donation Platform. All rights reserved.</div>

  <!-- ===== Edit dialog ===== -->
  <dialog id="editDlg">
    <div class="dlg-head">Edit Hospital Info</div>
    <div class="dlg-body">
      <label>Hospital Name</label>
      <input id="fName">

      <label>City / Region</label>
      <input id="fCity">

      <label>Location</label>
      <input id="fLocation" placeholder="e.g., Main Campus, King Fahd Rd">

      <label>Logo URL (optional)</label>
      <input id="fLogo" placeholder="https://...">

      <label>Branches (one per line)</label>
      <textarea id="fBranches" placeholder="Main Campus&#10;North Wing"></textarea>
    </div>
    <div class="dlg-actions">
      <button class="btn outline" onclick="closeEdit()">Cancel</button>
      <button class="btn" onclick="saveEdit()">Save</button>
    </div>
  </dialog>

  <!-- ===== Scripts ===== -->
  <script>
    const KEY_USER='wahib_user';

    function getUser(){
      return JSON.parse(localStorage.getItem(KEY_USER)||'null') || {
        role:'hospital',
        hospitalName:'King Khalid Hospital',
        region:'Riyadh',
        location:'Main Campus',
        branches:['Main Campus','North Wing'],
        logo:'',
        license:{name:'', dataUrl:''}
      };
    }
    function setUser(u){localStorage.setItem(KEY_USER, JSON.stringify(u));}

    function render(){
      const u=getUser();
      const logoImg=document.getElementById('logoImg');
      if(u.logo){ 
        logoImg.src=u.logo; 
        logoImg.classList.remove('ph'); 
        logoImg.style.objectFit='cover'; 
        logoImg.style.height='160px'; 
        logoImg.style.borderRadius='12px'; 
        logoImg.style.border='1px solid #ddd'; 
      } else { 
        logoImg.src='https://dummyimage.com/300x200/e9e9ea/9e9e9e&text=Logo'; 
        logoImg.classList.add('ph'); 
      }

      document.getElementById('vName').textContent = u.hospitalName||'—';
      document.getElementById('vCity').textContent = u.region||'—';
      document.getElementById('vLocation').textContent = u.location||'—';
      document.getElementById('vBranches').innerHTML = (u.branches&&u.branches.length)? u.branches.map(b=>`<div>${b}</div>`).join('') : '—';

      const hasLic = u.license && u.license.dataUrl;
      document.getElementById('viewBtn').disabled = !hasLic;
      document.getElementById('removeBtn').style.display = hasLic ? 'inline-block' : 'none';
      document.getElementById('licenseMeta').textContent = hasLic ? `Saved: ${u.license.name}` : 'No file uploaded yet.';

      // تحديث الهيدر (اسم ولوقو)
      const headerLogo=document.getElementById('headerLogo');
      const brandName=document.getElementById('brandName');
      if(u.logo) headerLogo.src=u.logo;
      if(u.hospitalName) brandName.textContent=u.hospitalName;
    }

    function triggerUpload(){ document.getElementById('licenseFile').click(); }
    document.getElementById('licenseFile').addEventListener('change', async (e)=>{
      const file=e.target.files[0];
      if(!file) return;
      const reader=new FileReader();
      reader.onload=()=> {
        const u=getUser();
        u.license={name:file.name, dataUrl:reader.result};
        setUser(u);
        render();
        alert('License uploaded successfully.');
      };
      reader.readAsDataURL(file);
    });

    function viewLicense(){
      const u=getUser();
      if(!(u.license && u.license.dataUrl)) return;
      const w=window.open();
      w.document.write(`<iframe src="${u.license.dataUrl}" style="width:100%;height:100vh;border:0"></iframe>`);
    }
    function removeLicense(){
      if(!confirm('Remove saved license file?')) return;
      const u=getUser(); u.license={name:'',dataUrl:''}; setUser(u); render();
    }

    function openEdit(){
      const u=getUser();
      document.getElementById('fName').value = u.hospitalName||'';
      document.getElementById('fCity').value = u.region||'';
      document.getElementById('fLocation').value = u.location||'';
      document.getElementById('fLogo').value = u.logo||'';
      document.getElementById('fBranches').value = (u.branches||[]).join('\n');
      document.getElementById('editDlg').showModal();
    }
    function closeEdit(){ document.getElementById('editDlg').close(); }

    function saveEdit(){
      const u=getUser();
      u.hospitalName = document.getElementById('fName').value.trim();
      u.region       = document.getElementById('fCity').value.trim();
      u.location     = document.getElementById('fLocation').value.trim();
      u.logo         = document.getElementById('fLogo').value.trim();
      u.branches     = document.getElementById('fBranches').value.split('\n').map(x=>x.trim()).filter(Boolean);
      setUser(u); closeEdit(); render();

      // بعد الحفظ ينتقل تلقائي للداشبورد
      window.location.href = 'hospital_dashboard.html';
    }

    render();
  </script>
</body>
</html>
